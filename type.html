<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forest Typing Academy - Carpe Tree'em</title>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  
  <style>
    /* Typing Game Specific Styles */
    .typing-container {
      max-width: 1000px;
      margin: 200px auto 40px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(44, 95, 45, 0.1);
    }

    .login-section {
      text-align: center;
      padding: 40px 20px;
    }

    .login-form {
      max-width: 400px;
      margin: 0 auto;
      background: var(--background-color);
      padding: 30px;
      border-radius: 8px;
      border: 2px solid var(--deep-forest-green);
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--deep-forest-green);
      font-weight: bold;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--soft-bark-gray);
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--deep-forest-green);
    }

    .typing-game {
      display: none;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--background-color);
      border-radius: 8px;
      border: 2px solid var(--deep-forest-green);
    }

    .stats {
      display: flex;
      gap: 30px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: var(--deep-forest-green);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-color);
      text-transform: uppercase;
    }

    .lesson-area {
      background: var(--background-color);
      padding: 30px;
      border-radius: 8px;
      border: 2px solid var(--deep-forest-green);
      margin-bottom: 20px;
    }

    .lesson-text {
      font-size: 18px;
      line-height: 1.8;
      color: var(--text-color);
      margin-bottom: 20px;
      min-height: 100px;
    }

    .typing-input {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px solid var(--soft-bark-gray);
      border-radius: 5px;
      font-family: monospace;
      box-sizing: border-box;
    }

    .typing-input:focus {
      outline: none;
      border-color: var(--deep-forest-green);
    }

    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .achievements-panel {
      background: var(--background-color);
      padding: 20px;
      border-radius: 8px;
      border: 2px solid var(--deep-forest-green);
      margin-top: 20px;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .achievement-card {
      background: white;
      padding: 15px;
      border-radius: 5px;
      border: 1px solid var(--soft-bark-gray);
      text-align: center;
    }

    .achievement-card.earned {
      border-color: var(--muted-golden-amber);
      background: linear-gradient(135deg, #fff, #f0f8ff);
    }

    .achievement-icon {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .achievement-card.earned .achievement-icon {
      color: var(--muted-golden-amber);
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: var(--soft-bark-gray);
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--deep-forest-green), var(--muted-golden-amber));
      transition: width 0.3s ease;
    }

    .lesson-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .lesson-btn {
      padding: 10px 20px;
      background: var(--background-color);
      border: 2px solid var(--deep-forest-green);
      color: var(--deep-forest-green);
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .lesson-btn:hover,
    .lesson-btn.active {
      background: var(--deep-forest-green);
      color: var(--background-color);
    }

    .lesson-btn.completed {
      background: var(--muted-golden-amber);
      border-color: var(--muted-golden-amber);
      color: white;
    }

    @media (max-width: 768px) {
      .typing-container {
        margin: 150px auto 20px;
        padding: 15px;
      }
      
      .game-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .stats {
        gap: 20px;
      }
      
      .controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Contact Header -->
  <div class="contact-header">
    <a href="tel:250-555-0123"><i class="fas fa-phone"></i> 250-555-0123</a>
    <a href="mailto:info@carpetreeem.ca"><i class="fas fa-envelope"></i> info@carpetreeem.ca</a>
    <a href="lets-talk.html"><i class="fas fa-comments"></i> Get a Quote</a>
  </div>

  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <div class="nav-logo">
        <a href="index.html">
          <img src="images/logo.png" alt="Carpe Tree'em Logo" class="nav-logo-img">
        </a>
      </div>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="services.html">Services</a>
        <a href="root-knowledge.html">Root Knowledge</a>
        <a href="lets-talk.html">Contact</a>
        <a href="type.html">Typing Game</a>
      </div>
    </div>
  </nav>

  <div class="typing-container">
    <!-- Login Section -->
    <div id="loginSection" class="login-section">
      <h1><i class="fas fa-tree"></i> Forest Typing Academy</h1>
      <p>Master typing while exploring the wonders of nature! Earn badges and track your progress.</p>
      
      <div class="login-form">
        <h2>Welcome Back, Forest Friend!</h2>
        <form id="loginForm">
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required>
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>
          </div>
          <button type="submit" class="cta-button">Login</button>
        </form>
        
        <hr style="margin: 20px 0; border: 1px solid var(--soft-bark-gray);">
        
        <h3>New to the Forest?</h3>
        <form id="signupForm">
          <div class="form-group">
            <label for="newUsername">Choose Username</label>
            <input type="text" id="newUsername" name="newUsername" required>
          </div>
          <div class="form-group">
            <label for="newPassword">Choose Password</label>
            <input type="password" id="newPassword" name="newPassword" required>
          </div>
          <button type="submit" class="cta-button">Create Account</button>
        </form>
      </div>
    </div>

    <!-- Typing Game Section -->
    <div id="typingGame" class="typing-game">
      <div class="game-header">
        <div>
          <h2>Welcome, <span id="userDisplayName"></span>! <i class="fas fa-leaf"></i></h2>
          <p>Current Lesson: <span id="currentLessonName">Home Row Basics</span></p>
        </div>
        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="wpmDisplay">0</div>
            <div class="stat-label">WPM</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="accuracyDisplay">0%</div>
            <div class="stat-label">Accuracy</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="streakDisplay">0</div>
            <div class="stat-label">Day Streak</div>
          </div>
        </div>
        <button onclick="logout()" class="cta-button">Logout</button>
      </div>

      <div class="lesson-selector">
        <button class="lesson-btn active" data-lesson="home-row">Home Row</button>
        <button class="lesson-btn" data-lesson="top-row">Top Row</button>
        <button class="lesson-btn" data-lesson="bottom-row">Bottom Row</button>
        <button class="lesson-btn" data-lesson="numbers">Numbers</button>
        <button class="lesson-btn" data-lesson="symbols">Symbols</button>
        <button class="lesson-btn" data-lesson="forest-words">Forest Words</button>
      </div>

      <div class="lesson-area">
        <div class="lesson-text" id="lessonText">
          Welcome to the Forest Typing Academy! Start with the home row keys: asdf jkl;
        </div>
        <div id="chunkInfo" style="text-align: center; margin: 10px 0; color: var(--deep-forest-green); font-weight: bold;">
          Chunk 1 of 5
        </div>
        <textarea 
          class="typing-input" 
          id="typingInput" 
          placeholder="Start typing here... Press Enter to advance to next chunk"
          rows="3"
        ></textarea>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="controls">
          <button onclick="startLesson()" class="cta-button">Start Lesson</button>
          <button onclick="resetLesson()" class="cta-button">Reset</button>
          <button onclick="nextChunk()" class="cta-button">Next Chunk</button>
          <button onclick="toggleAchievements()" class="cta-button">View Achievements</button>
        </div>
      </div>

      <div id="achievementsPanel" class="achievements-panel" style="display: none;">
        <h3><i class="fas fa-trophy"></i> Your Forest Achievements</h3>
        <div class="achievements-grid" id="achievementsGrid">
          <!-- Achievements will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2024 Carpe Tree'em. Professional tree care services.</p>
  </footer>

  <script>
    // User data structure
    let currentUser = null;
    let userData = {
      username: '',
      progress: {
        currentLesson: 'home-row',
        wpm: 0,
        accuracy: 0,
        streak: 0,
        completedLessons: [],
        weakKeys: {}
      },
      achievements: [],
      settings: {
        fingerOverlay: true,
        blankKeyboard: false
      }
    };

    // Lesson content
    const lessons = {
      'home-row': {
        name: 'Home Row Basics',
        text: 'asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl;',
        keys: ['a', 's', 'd', 'f', 'j', 'k', 'l', ';'],
        chunks: [
          'asdf jkl;',
          'asdf jkl; asdf jkl;',
          'asdf jkl; asdf jkl; asdf jkl;',
          'asdf jkl; asdf jkl; asdf jkl; asdf jkl;',
          'asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl;'
        ]
      },
      'top-row': {
        name: 'Top Row Adventure',
        text: 'qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty qwerty',
        keys: ['q', 'w', 'e', 'r', 't', 'y'],
        chunks: [
          'qwerty',
          'qwerty qwerty',
          'qwerty qwerty qwerty',
          'qwerty qwerty qwerty qwerty',
          'qwerty qwerty qwerty qwerty qwerty'
        ]
      },
      'bottom-row': {
        name: 'Bottom Row Explorer',
        text: 'zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn',
        keys: ['z', 'x', 'c', 'v', 'b', 'n'],
        chunks: [
          'zxcvbn',
          'zxcvbn zxcvbn',
          'zxcvbn zxcvbn zxcvbn',
          'zxcvbn zxcvbn zxcvbn zxcvbn',
          'zxcvbn zxcvbn zxcvbn zxcvbn zxcvbn'
        ]
      },
      'numbers': {
        name: 'Number Forest',
        text: '12345 67890 12345 67890 12345 67890 12345 67890 12345 67890 12345 67890',
        keys: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
        chunks: [
          '12345',
          '12345 67890',
          '12345 67890 12345',
          '12345 67890 12345 67890',
          '12345 67890 12345 67890 12345'
        ]
      },
      'symbols': {
        name: 'Symbol Safari',
        text: '!@#$% ^&*() !@#$% ^&*() !@#$% ^&*() !@#$% ^&*() !@#$% ^&*() !@#$% ^&*()',
        keys: ['!', '@', '#', '$', '%', '^', '&', '*', '(', ')'],
        chunks: [
          '!@#$%',
          '!@#$% ^&*()',
          '!@#$% ^&*() !@#$%',
          '!@#$% ^&*() !@#$% ^&*()',
          '!@#$% ^&*() !@#$% ^&*() !@#$%'
        ]
      },
      'forest-words': {
        name: 'Forest Vocabulary',
        text: 'tree bark leaf branch root trunk canopy forest nature green growth life earth soil water sun',
        keys: ['t', 'r', 'e', 'b', 'a', 'k', 'l', 'f', 'n', 'd', 'c', 'h', 'g', 'w', 's'],
        chunks: [
          'tree bark',
          'tree bark leaf branch',
          'tree bark leaf branch root trunk',
          'tree bark leaf branch root trunk canopy forest',
          'tree bark leaf branch root trunk canopy forest nature green'
        ]
      }
    };

    // Achievements
    const achievements = [
      { id: 'first-lesson', name: 'Forest Guardian', icon: '🌲', description: 'Complete your first lesson' },
      { id: 'wpm-20', name: 'Eagle Ace', icon: '🦅', description: 'Reach 20 WPM' },
      { id: 'wpm-40', name: 'Swift Deer', icon: '🦌', description: 'Reach 40 WPM' },
      { id: 'accuracy-95', name: 'Precision Owl', icon: '🦉', description: 'Achieve 95% accuracy' },
      { id: 'streak-7', name: 'Dedicated Beaver', icon: '🦫', description: '7-day practice streak' },
      { id: 'all-lessons', name: 'Forest Master', icon: '👑', description: 'Complete all lessons' }
    ];

    // Game state
    let gameState = {
      isActive: false,
      startTime: null,
      currentText: '',
      typedText: '',
      errors: 0,
      totalCharacters: 0,
      currentChunk: 0,
      totalChunks: 0
    };

    // Initialize the game
    document.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
      setupEventListeners();
      loadAchievements();
    });

    function setupEventListeners() {
      // Login form
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('signupForm').addEventListener('submit', handleSignup);
      
      // Typing input
      document.getElementById('typingInput').addEventListener('input', handleTyping);
      document.getElementById('typingInput').addEventListener('keydown', handleKeyDown);
      
      // Lesson selector
      document.querySelectorAll('.lesson-btn').forEach(btn => {
        btn.addEventListener('click', () => selectLesson(btn.dataset.lesson));
      });
    }

    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      // Check if user exists in localStorage
      const users = JSON.parse(localStorage.getItem('typingUsers') || '{}');
      
      if (users[username] && users[username].password === password) {
        loginUser(username, users[username]);
      } else {
        alert('Invalid username or password. Please try again or create a new account.');
      }
    }

    function handleSignup(e) {
      e.preventDefault();
      const username = document.getElementById('newUsername').value;
      const password = document.getElementById('newPassword').value;
      
      if (username.length < 3) {
        alert('Username must be at least 3 characters long.');
        return;
      }
      
      if (password.length < 4) {
        alert('Password must be at least 4 characters long.');
        return;
      }
      
      // Check if username already exists
      const users = JSON.parse(localStorage.getItem('typingUsers') || '{}');
      
      if (users[username]) {
        alert('Username already exists. Please choose a different one.');
        return;
      }
      
      // Create new user
      const newUser = {
        username: username,
        password: password,
        progress: {
          currentLesson: 'home-row',
          wpm: 0,
          accuracy: 0,
          streak: 0,
          completedLessons: [],
          weakKeys: {}
        },
        achievements: [],
        settings: {
          fingerOverlay: true,
          blankKeyboard: false
        },
        createdAt: new Date().toISOString()
      };
      
      users[username] = newUser;
      localStorage.setItem('typingUsers', JSON.stringify(users));
      
      loginUser(username, newUser);
    }

    function loginUser(username, userData) {
      currentUser = username;
      userData = userData;
      
      // Update display
      document.getElementById('userDisplayName').textContent = username;
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('typingGame').style.display = 'block';
      
      // Load user progress
      loadUserProgress();
      selectLesson(userData.progress.currentLesson);
      
      // Check for daily streak
      checkDailyStreak();
    }

    function logout() {
      currentUser = null;
      userData = null;
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('typingGame').style.display = 'none';
      
      // Clear forms
      document.getElementById('loginForm').reset();
      document.getElementById('signupForm').reset();
    }

    function checkLoginStatus() {
      // Check if user is already logged in (for session persistence)
      const lastUser = localStorage.getItem('lastLoggedInUser');
      if (lastUser) {
        const users = JSON.parse(localStorage.getItem('typingUsers') || '{}');
        if (users[lastUser]) {
          loginUser(lastUser, users[lastUser]);
        }
      }
    }

    function selectLesson(lessonId) {
      if (!lessons[lessonId]) return;
      
      // Update active button
      document.querySelectorAll('.lesson-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lesson === lessonId) {
          btn.classList.add('active');
        }
      });
      
      // Update lesson content
      const lesson = lessons[lessonId];
      document.getElementById('currentLessonName').textContent = lesson.name;
      
      // Reset game state
      resetLesson();
      
      // Set up chunk system
      gameState.currentChunk = 0;
      gameState.totalChunks = lesson.chunks.length;
      
      // Display first chunk
      displayCurrentChunk();
      
      // Update user progress
      if (currentUser) {
        userData.progress.currentLesson = lessonId;
        saveUserProgress();
      }
    }

    function displayCurrentChunk() {
      const lesson = lessons[userData.progress.currentLesson];
      if (!lesson || gameState.currentChunk >= lesson.chunks.length) return;
      
      const currentText = lesson.chunks[gameState.currentChunk];
      document.getElementById('lessonText').textContent = currentText;
      
      // Update chunk indicator
      const chunkInfo = document.getElementById('chunkInfo');
      if (chunkInfo) {
        chunkInfo.textContent = `Chunk ${gameState.currentChunk + 1} of ${gameState.totalChunks}`;
      }
    }

    function startLesson() {
      if (gameState.isActive) return;
      
      gameState.isActive = true;
      gameState.startTime = new Date();
      gameState.currentChunk = 0;
      gameState.typedText = '';
      gameState.errors = 0;
      gameState.totalCharacters = 0;
      
      // Display first chunk
      displayCurrentChunk();
      
      document.getElementById('typingInput').value = '';
      document.getElementById('typingInput').focus();
      document.getElementById('progressFill').style.width = '0%';
    }

    function resetLesson() {
      gameState.isActive = false;
      gameState.startTime = null;
      gameState.typedText = '';
      gameState.errors = 0;
      gameState.totalCharacters = 0;
      gameState.currentChunk = 0;
      
      // Reset to first chunk
      displayCurrentChunk();
      
      document.getElementById('typingInput').value = '';
      document.getElementById('progressFill').style.width = '0%';
    }

    function nextChunk() {
      if (!gameState.isActive) {
        alert('Please start the lesson first!');
        return;
      }
      
      const lesson = lessons[userData.progress.currentLesson];
      if (gameState.currentChunk < lesson.chunks.length - 1) {
        completeChunk();
      } else {
        alert('You\'re already on the last chunk! Complete it to finish the lesson.');
      }
    }

    function handleTyping(e) {
      if (!gameState.isActive) return;
      
      const input = e.target.value;
      const lesson = lessons[userData.progress.currentLesson];
      const currentChunkText = lesson.chunks[gameState.currentChunk];
      
      gameState.typedText = input;
      gameState.totalCharacters += input.length - gameState.typedText.length;
      
      // Calculate progress for current chunk
      const progress = Math.min((input.length / currentChunkText.length) * 100, 100);
      document.getElementById('progressFill').style.width = progress + '%';
      
      // Calculate errors for current chunk
      gameState.errors = 0;
      for (let i = 0; i < input.length; i++) {
        if (input[i] !== currentChunkText[i]) {
          gameState.errors++;
        }
      }
      
      // Check if current chunk is complete
      if (input.length >= currentChunkText.length) {
        completeChunk();
      }
    }

    function handleKeyDown(e) {
      if (!gameState.isActive) return;
      
      // Allow Enter key to advance to next chunk
      if (e.key === 'Enter') {
        e.preventDefault();
        const lesson = lessons[userData.progress.currentLesson];
        const currentChunkText = lesson.chunks[gameState.currentChunk];
        const input = document.getElementById('typingInput').value;
        
        // If current chunk is complete, advance to next
        if (input.length >= currentChunkText.length) {
          completeChunk();
        } else {
          // Show hint to complete current chunk
          alert('Complete the current text before pressing Enter, or press Enter to skip to next chunk.');
        }
        return;
      }
      
      // Prevent backspace from going beyond start
      if (e.key === 'Backspace' && gameState.typedText.length === 0) {
        e.preventDefault();
      }
    }

    function completeChunk() {
      const lesson = lessons[userData.progress.currentLesson];
      
      // Move to next chunk
      gameState.currentChunk++;
      
      // Clear input
      document.getElementById('typingInput').value = '';
      gameState.typedText = '';
      
      // Check if lesson is complete
      if (gameState.currentChunk >= lesson.chunks.length) {
        completeLesson();
      } else {
        // Display next chunk
        displayCurrentChunk();
        document.getElementById('progressFill').style.width = '0%';
        document.getElementById('typingInput').focus();
      }
    }

    function completeLesson() {
      gameState.isActive = false;
      
      // Calculate WPM and accuracy
      const timeElapsed = (new Date() - gameState.startTime) / 1000 / 60; // minutes
      const wpm = Math.round(gameState.totalCharacters / 5 / timeElapsed);
      const accuracy = Math.round(((gameState.totalCharacters - gameState.errors) / gameState.totalCharacters) * 100);
      
      // Update user progress
      userData.progress.wpm = Math.max(userData.progress.wpm, wpm);
      userData.progress.accuracy = Math.max(userData.progress.accuracy, accuracy);
      
      // Mark lesson as completed
      const currentLesson = userData.progress.currentLesson;
      if (!userData.progress.completedLessons.includes(currentLesson)) {
        userData.progress.completedLessons.push(currentLesson);
      }
      
      // Update display
      document.getElementById('wpmDisplay').textContent = wpm;
      document.getElementById('accuracyDisplay').textContent = accuracy + '%';
      
      // Check for achievements
      checkAchievements(wpm, accuracy);
      
      // Save progress
      saveUserProgress();
      
      // Show completion message
      setTimeout(() => {
        alert(`Lesson completed!\nWPM: ${wpm}\nAccuracy: ${accuracy}%\nGreat job, forest friend!`);
      }, 100);
    }

    function checkAchievements(wpm, accuracy) {
      const newAchievements = [];
      
      // First lesson achievement
      if (userData.progress.completedLessons.length === 1) {
        newAchievements.push('first-lesson');
      }
      
      // WPM achievements
      if (wpm >= 20 && !userData.achievements.includes('wpm-20')) {
        newAchievements.push('wpm-20');
      }
      if (wpm >= 40 && !userData.achievements.includes('wpm-40')) {
        newAchievements.push('wpm-40');
      }
      
      // Accuracy achievement
      if (accuracy >= 95 && !userData.achievements.includes('accuracy-95')) {
        newAchievements.push('accuracy-95');
      }
      
      // All lessons achievement
      if (userData.progress.completedLessons.length >= Object.keys(lessons).length && !userData.achievements.includes('all-lessons')) {
        newAchievements.push('all-lessons');
      }
      
      // Add new achievements
      newAchievements.forEach(achievementId => {
        if (!userData.achievements.includes(achievementId)) {
          userData.achievements.push(achievementId);
        }
      });
      
      // Show achievement notifications
      newAchievements.forEach(achievementId => {
        const achievement = achievements.find(a => a.id === achievementId);
        if (achievement) {
          setTimeout(() => {
            alert(`🏆 Achievement Unlocked: ${achievement.name}!\n${achievement.description}`);
          }, 200);
        }
      });
    }

    function checkDailyStreak() {
      const today = new Date().toDateString();
      const lastLogin = localStorage.getItem(`lastLogin_${currentUser}`);
      
      if (lastLogin !== today) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toDateString();
        
        if (lastLogin === yesterdayStr) {
          userData.progress.streak++;
        } else {
          userData.progress.streak = 1;
        }
        
        localStorage.setItem(`lastLogin_${currentUser}`, today);
        document.getElementById('streakDisplay').textContent = userData.progress.streak;
        
        // Check for streak achievement
        if (userData.progress.streak >= 7 && !userData.achievements.includes('streak-7')) {
          userData.achievements.push('streak-7');
          setTimeout(() => {
            alert('🏆 Achievement Unlocked: Dedicated Beaver!\n7-day practice streak achieved!');
          }, 100);
        }
      }
    }

    function loadUserProgress() {
      const users = JSON.parse(localStorage.getItem('typingUsers') || '{}');
      if (users[currentUser]) {
        userData = users[currentUser];
        
        // Update display
        document.getElementById('wpmDisplay').textContent = userData.progress.wpm;
        document.getElementById('accuracyDisplay').textContent = userData.progress.accuracy + '%';
        document.getElementById('streakDisplay').textContent = userData.progress.streak;
        
        // Update lesson buttons
        document.querySelectorAll('.lesson-btn').forEach(btn => {
          const lessonId = btn.dataset.lesson;
          if (userData.progress.completedLessons.includes(lessonId)) {
            btn.classList.add('completed');
          }
        });
      }
    }

    function saveUserProgress() {
      const users = JSON.parse(localStorage.getItem('typingUsers') || '{}');
      users[currentUser] = userData;
      localStorage.setItem('typingUsers', JSON.stringify(users));
      localStorage.setItem('lastLoggedInUser', currentUser);
    }

    function loadAchievements() {
      const grid = document.getElementById('achievementsGrid');
      grid.innerHTML = '';
      
      achievements.forEach(achievement => {
        const card = document.createElement('div');
        card.className = 'achievement-card';
        if (userData && userData.achievements.includes(achievement.id)) {
          card.classList.add('earned');
        }
        
        card.innerHTML = `
          <div class="achievement-icon">${achievement.icon}</div>
          <h4>${achievement.name}</h4>
          <p>${achievement.description}</p>
        `;
        
        grid.appendChild(card);
      });
    }

    function toggleAchievements() {
      const panel = document.getElementById('achievementsPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }
  </script>
</body>
</html> 
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>🌳 New Quote #123 - Complete Analysis Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.4; color: #333; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #2c5f2d, #3a7a3e); color: white; padding: 20px; text-align: center; }
        .section { padding: 20px; border-bottom: 1px solid #eee; }
        .grid-4 { display: grid; grid-template-columns: 250px 1fr 1fr 1fr; gap: 20px; margin: 20px 0; }
        .ai-column { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px solid #e9ecef; }
        .ai-gemini { border-color: #4285f4; background: #f8fbff; }
        .ai-openai { border-color: #00a67e; background: #f0fdf4; }
        .ai-claude { border-color: #cc785c; background: #fdf8f6; }
        .selection-column { background: #fff3cd; padding: 15px; border-radius: 8px; border: 2px solid #ffd700; }
        .checkbox-group { margin: 10px 0; }
        .checkbox-group input[type="checkbox"] { margin-right: 8px; transform: scale(1.2); }
        .data-item { margin: 8px 0; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #28a745; }
        .cost-summary { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0; font-weight: bold; }
        .media-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; }
        .media-item { background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center; }
        .media-item img { max-width: 100%; height: 120px; object-fit: cover; border-radius: 4px; }
        .btn { background: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin: 4px; }
        .btn-admin { background: #28a745; }
        .btn-maps { background: #4285f4; }
        .line-item { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 6px; border-left: 4px solid #28a745; }
        .urgency-high { border-left-color: #dc3545; background: #f8d7da; }
        .urgency-medium { border-left-color: #ffc107; background: #fff3cd; }
        .analysis-text { background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6; white-space: pre-line; max-height: 300px; overflow-y: auto; }
        .context-input { width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 8px 0; }
        .retrigger-btn { background: #17a2b8; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Quote Summary -->
        <div class="header">
            <h1>🌳 New Quote #123 - Phil Bajenski</h1>
            <p>📧 phil.bajenski@gmail.com | 📞 778-655-3741 | 📍 45km from base</p>
            <p>🕒 Submitted: 2025-08-04 07:06:45 | 📋 Services: Tree Assessment, Pruning</p>
        </div>

        <!-- Customer & Location Info -->
        <div class="section">
            <h2>👤 Customer Information</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <strong>Contact:</strong><br>
                    📧 phil.bajenski@gmail.com<br>
                    📞 778-655-3741<br>
                    📍 404 Kildare St, New Denver, BC
                </div>
                <div>
                    <strong>Location:</strong><br>
                    🗺️ Distance: 45km (1h 15m)<br>
                    📊 Travel Cost: $90<br>
                    🎯 GPS: 49.3243, -117.3678
                </div>
                <div>
                    <strong>Request Details:</strong><br>
                    📝 Notes: Large maple tree assessment - concerned about dead branches near house.<br>
                    📊 Urgency: Routine<br>
                    🔄 Status: ai_processing
                </div>
            </div>
        </div>

        <!-- Media Files Section -->
        <div class="section">
            <h2>📸 Media Files (4 files)</h2>
            <div class="media-grid">
                
<div class="media-item">
    <img src="/uploads/tree_front_view.jpg" alt="Front view of tree">
    <div>tree_front_view.jpg</div>
    <a href="/uploads/tree_front_view.jpg" class="btn">📷 View Full Size</a>
</div>
<div class="media-item">
    <img src="/uploads/tree_side_angle.jpg" alt="Side angle">
    <div>tree_side_angle.jpg</div>
    <a href="/uploads/tree_side_angle.jpg" class="btn">📷 View Full Size</a>
</div>
<div class="media-item">
    <img src="/uploads/tree_base_damage.jpg" alt="Base damage detail">
    <div>tree_base_damage.jpg</div>
    <a href="/uploads/tree_base_damage.jpg" class="btn">📷 View Full Size</a>
</div>
<div class="media-item">
    <div style="background: #f8f9fa; height: 120px; display: flex; align-items: center; justify-content: center; border-radius: 4px;">
        📹 tree_assessment.mp4
    </div>
    <div>tree_assessment.mp4</div>
    <a href="/uploads/tree_assessment.mp4" class="btn">🎬 Play Video</a>
</div>
            </div>
        </div>

        <!-- 4-Column AI Analysis Comparison -->
        <div class="section">
            <h2>🤖 AI Analysis Comparison & Selection</h2>
            <div class="grid-4">
                <!-- Selection Column -->
                <div class="selection-column">
                    <h3>✅ Your Selection</h3>
                    <p><em>Check the boxes for the analysis you want to use:</em></p>
                    
                    <div class="data-item">
                        <strong>Tree Species:</strong>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="species_gemini"> Gemini: Oak (85% confidence)</label><br>
                            <label><input type="checkbox" name="species_openai"> OpenAI: Maple (92% confidence)</label><br>
                            <label><input type="checkbox" name="species_claude"> Claude: Birch (78% confidence)</label><br>
                            <input type="text" placeholder="Or enter manually..." class="context-input">
                        </div>
                    </div>

                    <div class="data-item">
                        <strong>Tree Height:</strong>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="height_gemini"> Gemini: 18m</label><br>
                            <label><input type="checkbox" name="height_openai"> OpenAI: 20m</label><br>
                            <label><input type="checkbox" name="height_claude"> Claude: 17m</label><br>
                            <input type="text" placeholder="Or enter manually..." class="context-input">
                        </div>
                    </div>

                    <div class="data-item">
                        <strong>Crown Spread:</strong>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="crown_gemini"> Gemini: 12m</label><br>
                            <label><input type="checkbox" name="crown_openai"> OpenAI: 14m</label><br>
                            <label><input type="checkbox" name="crown_claude"> Claude: 11m</label><br>
                            <input type="text" placeholder="Or enter manually..." class="context-input">
                        </div>
                    </div>

                    <div class="data-item">
                        <strong>DBH (Diameter at Breast Height):</strong>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="dbh_gemini"> Gemini: 45cm</label><br>
                            <label><input type="checkbox" name="dbh_openai"> OpenAI: 52cm</label><br>
                            <label><input type="checkbox" name="dbh_claude"> Claude: 48cm</label><br>
                            <input type="text" placeholder="Or enter manually..." class="context-input">
                        </div>
                    </div>
                </div>

                <!-- Gemini Analysis -->
                <div class="ai-column ai-gemini">
                    <h3>🔷 Google Gemini 2.5 Pro</h3>
                    <div class="cost-summary">💰 Cost: $0.15</div>
                    
                    <div class="analysis-text">Large mature oak tree showing good overall health. Minor deadwood in crown requires removal. Tree is well-positioned and structurally sound. Recommended maintenance pruning to remove deadwood and improve air circulation.</div>
                    
                    <h4>📋 Line Items:</h4>
                    
<div class="line-item">
    <div class="line-item-header">Tree Pruning - Deadwood Removal</div>
    <div class="line-item-price">$450 - $650 (climbing access required)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Crown Thinning</div>
    <div class="line-item-price">$300 - $500 (improve air circulation)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Brush Removal</div>
    <div class="line-item-price">$150 - $200 (estimated 2m³ of brush)</div>
</div>
                    
                    <div class="cost-summary">Total: $1125</div>
                    
                    <textarea placeholder="Add context for re-analysis..." class="context-input"></textarea>
                    <button class="retrigger-btn" onclick="retriggerAnalysis('gemini')">🔄 Re-analyze with Context</button>
                </div>

                <!-- OpenAI Analysis -->
                <div class="ai-column ai-openai">
                    <h3>🟢 OpenAI GPT-4</h3>
                    <div class="cost-summary">💰 Cost: $0.23</div>
                    
                    <div class="analysis-text">This appears to be a mature maple tree with significant size and good structural integrity. Some concern about proximity to structures. Tree shows signs of stress in certain areas but overall healthy.</div>
                    
                    <h4>📋 Line Items:</h4>
                    
<div class="line-item">
    <div class="line-item-header">Tree Removal (if required)</div>
    <div class="line-item-price">$1,200 - $1,800 (complex rigging needed)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Alternative: Heavy Pruning</div>
    <div class="line-item-price">$600 - $900 (reduce crown by 30%)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Stump Grinding</div>
    <div class="line-item-price">$350 - $500 (if removal chosen)</div>
</div>
                    
                    <div class="cost-summary">Total: $1450</div>
                    
                    <textarea placeholder="Add context for re-analysis..." class="context-input"></textarea>
                    <button class="retrigger-btn" onclick="retriggerAnalysis('openai')">🔄 Re-analyze with Context</button>
                </div>

                <!-- Claude Analysis -->
                <div class="ai-column ai-claude">
                    <h3>🟠 Anthropic Claude</h3>
                    <div class="cost-summary">💰 Cost: $0.18</div>
                    
                    <div class="analysis-text">Birch tree displaying characteristic bark and growth pattern. Tree appears to be in decline phase with some dieback visible in upper crown. Structural assessment needed to determine safety.</div>
                    
                    <h4>📋 Line Items:</h4>
                    
<div class="line-item">
    <div class="line-item-header">Tree Health Assessment</div>
    <div class="line-item-price">$200 - $300 (professional evaluation)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Crown Reduction</div>
    <div class="line-item-price">$400 - $700 (if tree is salvageable)</div>
</div>
<div class="line-item">
    <div class="line-item-header">Complete Removal</div>
    <div class="line-item-price">$800 - $1,200 (if assessment shows decay)</div>
</div>
                    
                    <div class="cost-summary">Total: $1050</div>
                    
                    <textarea placeholder="Add context for re-analysis..." class="context-input"></textarea>
                    <button class="retrigger-btn" onclick="retriggerAnalysis('claude')">🔄 Re-analyze with Context</button>
                </div>
            </div>
        </div>

        <!-- Itemized Cost Breakdown -->
        <div class="section">
            <h2>💰 Detailed Cost Breakdown</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="line-item">
                    <strong>🌲 Tree Work:</strong><br>
                    • Removal: $1200-1800<br>
                    • Pruning: $600-900<br>
                    • Climbing: $300-450<br>
                    • Rigging: $200-400
                </div>
                <div class="line-item">
                    <strong>🗑️ Disposal:</strong><br>
                    • Brush Removal: $150-250<br>
                    • Wood Processing: $100-200<br>
                    • Firewood Service: $150-300<br>
                    • Transfer Station: $85-120
                </div>
                <div class="line-item">
                    <strong>🚛 Logistics:</strong><br>
                    • Travel (45km): $90<br>
                    • Equipment Transport: $75-150<br>
                    • Disposal Transport: $50-100
                </div>
            </div>
            
            <div class="cost-summary" style="font-size: 1.2em; text-align: center; margin-top: 20px;">
                🎯 <strong>TOTAL QUOTE RANGE: $900 - $2300</strong>
            </div>
        </div>

        <!-- Waste Disposal Information -->
        <div class="section">
            <h2>🗑️ Waste Disposal Analysis</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <strong>Nearest Transfer Station:</strong><br>
                    📍 Castlegar Regional Landfill<br>
                    🛣️ Distance: 35km<br>
                    💰 Cost: $85/tonne<br>
                    📊 Estimated Weight: 2.5 tonnes
                </div>
                <div>
                    <strong>Brush Volume Estimate:</strong><br>
                    🌿 Volume: 15m³<br>
                    ⚖️ Weight: 2.2 tonnes<br>
                    🚛 Truck Loads: 2<br>
                    💰 Total Disposal: $220
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="section" style="text-align: center;">
            <a href="https://carpetree.com/admin-dashboard.html?quote=123" class="btn btn-admin">🎛️ Open Full Admin Dashboard</a>
            <a href="https://maps.google.com/maps?q=404 Kildare St, New Denver, BC" class="btn btn-maps">🗺️ View Location on Maps</a>
            <a href="https://carpetree.com/customer-crm-dashboard.html?customer_id=789" class="btn">👤 Customer History</a>
            <a href="mailto:phil.bajenski@gmail.com" class="btn">📧 Email Customer</a>
        </div>

        <!-- AI Cost Summary -->
        <div class="section">
            <h2>📊 AI Analysis Cost Summary</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="cost-summary">Gemini: $0.15</div>
                <div class="cost-summary">OpenAI: $0.23</div>
                <div class="cost-summary">Claude: $0.18</div>
                <div class="cost-summary"><strong>Total AI Cost: $0.56</strong></div>
            </div>
        </div>

        <!-- Audio Transcription -->
        <div class="section" style="display: none;">
            <h2>🎵 Audio Transcription</h2>
            <div class="analysis-text"></div>
        </div>

        <!-- Footer -->
        <div style="background: #f8f9fa; padding: 20px; text-align: center; color: #666;">
            <p>🌲 <strong>Carpe Tree'em Professional Analysis Dashboard</strong></p>
            <p>Generated: 2025-08-04 07:06:45 | Quote ID: #123</p>
        </div>
    </div>

    <script>
        function retriggerAnalysis(aiType) {
            const textarea = event.target.previousElementSibling;
            const context = textarea.value;
            const quoteId = "123";
            
            if (!context.trim()) {
                alert('Please add some context for the re-analysis');
                return;
            }
            
            // Log usage
            fetch('/server/api/log-admin-usage.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: 'retrigger_analysis',
                    ai_type: aiType,
                    quote_id: quoteId,
                    context: context,
                    timestamp: new Date().toISOString()
                })
            });
            
            // Trigger re-analysis
            alert(`Re-triggering ${aiType} analysis with your context...`);
            window.location.href = `/server/api/regenerate-ai-analysis.php?quote_id=${quoteId}&ai_type=${aiType}&context=${encodeURIComponent(context)}`;
        }
        
        // Log selection changes
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox' || e.target.type === 'text') {
                fetch('/server/api/log-admin-usage.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        action: 'selection_change',
                        field: e.target.name || 'manual_input',
                        value: e.target.type === 'checkbox' ? e.target.checked : e.target.value,
                        quote_id: "123",
                        timestamp: new Date().toISOString()
                    })
                });
            }
        });
    </script>
</body>
</html>
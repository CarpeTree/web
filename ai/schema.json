{
  "type": "function",
  "function": {
    "name": "draft_tree_quote",
    "description": "Generate a comprehensive tree care quote with detailed analysis, tree inventory, and itemized estimate.",
    "parameters": {
      "type": "object",
      "properties": {
        "analysis": {
          "type": "string",
          "description": "A detailed, multi-paragraph analysis of the tree(s), site conditions, access, hazards, and special considerations."
        },
        "trees": {
          "type": "array",
          "description": "Array of trees identified on the property requiring work.",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string", "description": "Tree identifier (e.g., T1, T2)" },
              "species": { "type": "string", "description": "Common and scientific name" },
              "dbh_inches": { "type": "number", "description": "Diameter at Breast Height in inches" },
              "height_feet": { "type": "number", "description": "Estimated height in feet" },
              "crown_spread_feet": { "type": "number", "description": "Crown spread in feet" },
              "condition": { "type": "string", "description": "Overall condition assessment" },
              "lean_direction": { "type": "string", "description": "Direction and degree of lean if any" },
              "defects": { "type": "string", "description": "Any structural defects, decay, or hazards" },
              "location": { "type": "string", "description": "Location on property relative to structures" }
            },
            "required": ["id", "species", "dbh_inches", "height_feet"]
          }
        },
        "site_assessment": {
          "type": "object",
          "properties": {
            "access_type": { "type": "string", "description": "Road, boat, steep terrain, etc." },
            "hazards": { "type": "array", "items": { "type": "string" }, "description": "List of site hazards" },
            "targets": { "type": "array", "items": { "type": "string" }, "description": "Structures/items at risk" },
            "drop_zone": { "type": "string", "description": "Available drop zone description" },
            "terrain": { "type": "string", "description": "Terrain conditions" }
          }
        },
        "rigging_plan": {
          "type": "object",
          "properties": {
            "method": { "type": "string", "description": "Primary rigging method (negative, positive, speedline, etc.)" },
            "equipment_needed": { "type": "array", "items": { "type": "string" }, "description": "Equipment list" },
            "crew_size": { "type": "number", "description": "Recommended crew size" },
            "estimated_days": { "type": "number", "description": "Estimated days to complete" }
          }
        },
        "volume_weight": {
          "type": "object",
          "properties": {
            "total_wood_volume_cuft": { "type": "number", "description": "Total wood volume in cubic feet" },
            "total_weight_lbs": { "type": "number", "description": "Total estimated green weight in pounds" },
            "brush_volume_cuft": { "type": "number", "description": "Brush/chippable material volume" },
            "disposal_tonnes": { "type": "number", "description": "Estimated disposal weight in tonnes" }
          }
        },
        "time_estimate": {
          "type": "object",
          "properties": {
            "setup_hours": { "type": "number" },
            "climbing_rigging_hours": { "type": "number" },
            "cleanup_hours": { "type": "number" },
            "total_man_hours": { "type": "number" },
            "notes": { "type": "string" }
          }
        },
        "estimate_line_items": {
          "type": "array",
          "description": "Itemized estimate for customer. Each line item should be a distinct service.",
          "items": {
            "type": "object",
            "properties": {
              "service": { "type": "string", "description": "Service name (e.g., Tree Removal, Pruning, Travel)" },
              "tree_id": { "type": "string", "description": "Which tree this applies to (T1, T2, or 'All')" },
              "description": { "type": "string", "description": "Detailed description of work" },
              "quantity": { "type": "number", "description": "Quantity (usually 1)" },
              "unit": { "type": "string", "description": "Unit (Tree, Hour, Trip, Tonne, etc.)" },
              "unit_price": { "type": "number", "description": "Price per unit in CAD" },
              "total": { "type": "number", "description": "Line total in CAD" },
              "internal_notes": { "type": "string", "description": "Notes for contractor only (not shown to customer)" }
            },
            "required": ["service", "description", "total"]
          }
        },
        "pricing_summary": {
          "type": "object",
          "properties": {
            "subtotal": { "type": "number", "description": "Subtotal before tax" },
            "gst": { "type": "number", "description": "5% GST" },
            "total_cad": { "type": "number", "description": "Total including tax" }
          },
          "required": ["subtotal", "gst", "total_cad"]
        },
        "follow_up_questions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Questions to ask customer for clarification"
        },
        "nearest_hospital": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "address": { "type": "string" },
            "distance_km": { "type": "number" },
            "drive_time_minutes": { "type": "number" }
          }
        }
      },
      "required": [
        "analysis",
        "trees",
        "estimate_line_items",
        "pricing_summary"
      ]
    }
  }
}
